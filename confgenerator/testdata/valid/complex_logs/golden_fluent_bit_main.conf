[SERVICE]
    # https://docs.fluentbit.io/manual/administration/configuring-fluent-bit/configuration-file#config_section
    # Flush logs every 1 second, even if the buffer is not full to minimize log entry arrival delay.
    Flush      1
    # Waits 120 seconds after receiving a SIGTERM before it shuts down to minimize log loss.
    Grace      120
    # We use systemd to manage Fluent Bit instead.
    Daemon     off
    Log_File   /var/log/google-cloud-ops-agent/subagents/fluent-bit.log
    Log_Level  info

    # https://docs.fluentbit.io/manual/administration/monitoring
    # Enable a built-in HTTP server that can be used to query internal information and monitor metrics of each running plugin.
    HTTP_Server  On
    HTTP_Listen  0.0.0.0
    HTTP_PORT    2020

    # https://docs.fluentbit.io/manual/administration/buffering-and-storage#service-section-configuration
    storage.path               /var/lib/google-cloud-ops-agent/buffers/fluent-bit
    storage.sync               normal
    # Enable the data integrity check when writing and reading data from the filesystem.
    storage.checksum           on
    # The maximum amount of data to load into the memory when processing old chunks from the backlog that is from previous Fluent Bit processes (e.g. Fluent Bit may have crashed or restarted).
    storage.backlog.mem_limit  50M
    # Enable storage metrics in the built-in HTTP server.
    storage.metrics            on

[INPUT]
    Name tail
    DB log_source_id1
    Path /path/to/log/1/a/*,/path/to/log/1/b/*
    Tag log_source_id1
    Buffer_Chunk_Size 32k
    Buffer_Max_Size 32k
    DB.Sync Full
    Refresh_Interval 60
    Rotate_Wait 5
    Skip_Long_Lines On
    Key message
    Exclude_Path /path/to/log/1/a/exclude_a,/path/to/log/1/b/exclude_b

[INPUT]
    Name tail
    DB log_source_id2
    Path /path/to/log/2/a/*,/path/to/log/2/b/*
    Tag log_source_id2
    Buffer_Chunk_Size 32k
    Buffer_Max_Size 32k
    DB.Sync Full
    Refresh_Interval 60
    Rotate_Wait 5
    Skip_Long_Lines On
    Key message
    Exclude_Path /path/to/log/2/a/exclude_a,/path/to/log/2/b/exclude_b

[INPUT]
    Name syslog
    Mode tcp
    Listen 1.1.1.1
    Tag test_syslog_source_id_tcp
    Port 1111
    Parser default_message_parser

[INPUT]
    Name syslog
    Mode udp
    Listen 2.2.2.2
    Tag test_syslog_source_id_udp
    Port 2222
    Parser default_message_parser

[FILTER]
    Name parser
    Match test_syslog_source_id_tcp
    Key_Name message
    Parser syslog-rfc5424

[FILTER]
    Name parser
    Match test_syslog_source_id_udp
    Key_Name message
    Parser syslog-rfc3164

[OUTPUT]
    Name stackdriver
    resource gce_instance
    Match log_source_id1

[OUTPUT]
    Name stackdriver
    resource gce_instance
    Match log_source_id2

[OUTPUT]
    Name stackdriver
    resource gce_instance
    Match test_syslog_source_id_tcp

[OUTPUT]
    Name stackdriver
    resource gce_instance
    Match test_syslog_source_id_udp

